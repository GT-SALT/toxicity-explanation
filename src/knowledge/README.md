# Implicit/Explicit Knowledge Models

## Explicit Knowledge Models

### Training the Explicit Knowledge Model
To train the explicit knowledge model, first download conceptnet data:

```
mkdir data
cd data
wget https://s3.amazonaws.com/conceptnet/downloads/2019/edges/conceptnet-assertions-5.7.0.csv.gz
gunzip conceptnet-assertions-5.7.0.csv.gz
```

Then cd back out of the data directory and run the train file. An example command below trains the explicit knowledge model by querying for 5 additional 
knowledge tuples from ConceptNET, and directly concatenates them to the input (model_type flag should be set to "input").

```
python train.py --model_type input --data_file ../../data/SBIC.v2.trn.csv
```

### Testing the Explicit Knowledge Model
To test the trained knowledge model, run the test.py file. Pass in the same model_type and k value as the trained model. An example command for a model 
trained per the settings in the command above is given below:

```
python test.py --model_type input --data_file ../../data/SBIC.v2.trn.csv --model model/bart_knowledge_k_25/
```

## Implicit Knowledge Models

### Training the Implicit Knowledge Model
To train the implicit knowledge model, first train a target minority generator, then pretrain on a dataset created using prompts and the target minority generator, and finally train the implicit knowledge model.

To train a target minority generator, call the train_implicit.py file with the appropriate model_type arg. Here's an example, trained on the SBIC dataset:

```
python train_implicit.py --model_type target_minority --data_file ../../data/SBIC.v2.trn.csv
```

Next, pretrain the model to generate implicit knowledge generated by a GPT type model, based on the target minority. Here is a command that uses the 
target minority model generated above and uses gpt2 as the implicit knowledge generator. It also generated 15 implicit knowledge sentences per input and
uses the SBIC dataset:

```
python train_implicit.py --model_type implicit_knowledge --k 15 --data_file ../../data/SBIC.v2.trn.csv --target_minority_model model/bart_target_minority_sbic/
```

Finally, fine tune the pretrained model to generate stereotypes, by passing in the appropriate model type and the path to the model trained using the 
previous command:

```
python train_implicit.py --model_type stereotype --data_file ../../data/SBIC.v2.trn.csv --implicit_knowledge_model model/bart_implicit_bias_knowledge_gpt2_k_15/
```

### Testing the Implicit Knowledge Model
Finally, test the implicit knowledge model trained above by passing in the trained model path and the appropriate model_type flag. Here is an example 
command:

```
python test_implicit.py --model_type stereotype --model model/bart_implicit_stereotype_gpt2_k_15
```
